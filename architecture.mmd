%%{init: {'theme':'dark', 'themeVariables':{'fontSize':'18px'}}}%%
graph TD
    %% Mobile Layer
    subgraph Android["Android End-User App (100% Offline)"]
        UI["Android Native Compose UI"]
        
        %% Sensors
        subgraph Sensors["Sensor Acquisition"]
            Cam["Camera (rPPG, Edema, Pallor, Jaundice)"]
            Mic["Microphone (Respiratory/Cough)"]
        end

        %% Mobile Inference
        subgraph MobileInfer["On-Device Inference Pipeline"]
            AudioProc["HeAR Audio Predictor (TFLite)"]
            VisionProc["Vision Landmarker & MediaPipe"]
            Sanitizer["PromptSanitizer (Injection Protection)"]
            Triage["MedGemma 4B Engine (Q4_K_M GGUF)"]
            Translator["ML Kit Translation (Local Language)"]
            Reasoner["ClinicalReasoner (Confidence Gating)"]
        end

        UI --> Sensors
        Cam --> VisionProc
        Mic --> AudioProc
        
        VisionProc --> Reasoner
        AudioProc --> Reasoner
        
        Reasoner --> Sanitizer
        Sanitizer --> Translator
        Translator --> Triage
        Triage --> Translator
        Translator --> UI
    end
